# 面向切面编程

`AOP`为Aspect Oriented Programming的缩写，意为：面向切面编程。

通过预编译方式和运行期间动态代理，来实现**程序功能的统一维护**的一种技术。`AOP`是`OOP`的延续，是软件开发中的一个热点，也是Spring框架中的一个重要内容，是函数式编程的一种衍生范型。

- 利用`AOP`可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。
- 可以把之前分散在应用各处的行为放在可重用的模块中，可以有效减少冗余代码，并让我们的类只关注自身的主要功能。

常见的使用场景：
- 日志
- 事物
- 数据库操作
## AOP 概述
每个横切关注点都集中在一个地方，而不是分散在多处代码中。这样使我们的服务模块更加简洁，因为它们只包含了主要关注点的代码，而次要的功能或者说辅助的功能被转移到切面中了。

![](https://upload-images.jianshu.io/upload_images/3568417-dfd693fe1eb80605.png?imageMogr2/auto-orient/strip|imageView2/2/w/696/format/webp)

上图表示划分为三个服务模块的应用，每个模块提供相应的服务，而且这些模块都需要类似的辅助功能，例如日志、安全、事务等等。我们并不想在各个模块中写重复的日志、安全、事务的代码，那么就可以使用选用切面这个方案，来解决这个问题。

若不使用AOP，则会出现代码纠缠，即交叉业务逻辑与主业务逻辑混合在一起。这样，会使业务逻辑变得混杂不清。

## AOP 术语

![](https://upload-images.jianshu.io/upload_images/3568417-0f9593ceabe8601d.png?imageMogr2/auto-orient/strip|imageView2/2/w/552/format/webp)



- advice - 通知，切面的具体行为，即要切入执行的代码。比如事物处理，日志处理就可以理解为切面。常用的切面有通知与顾问。实际就是对主业务逻辑的一种增强
- pointcut - 切点，通知被应用的具体位置
- join point - 连接点，程序运行时，能够应用通知的所有点
- aspect - 切面，什么时候在什么地方做什么事情，是切点和通知的结合
- target - 目标对象，被切入功能的目标对象
- introduction - 引入，将新的方法或属性引入到现有的类中
- weaving - 织入，把切面应用到目标对象并创建新的代理对象的过程

## 示例
银行系统取款会有一个流程查询也会有一个流程：

![](https://img-blog.csdnimg.cn/20190527201358371.png)

上述流程都有一个**相同的验证用户的流程**。
　　
这个时候 AOP 就可以来帮我们简化代码了。首先，写代码的时候可以不写这个验证用户的步骤，即完全不考虑验证用户，写完之后，在另外一个地方，写好验证用户的代码，然后告诉 Spring 你要把这一段代码加到哪几个地方，Spring就会帮你加过去。

这里还只是两个地方，如果有多个控制流，这样写代码会大大节约时间。而且 AOP 不会把代码加到源文件里，但是它会正确的影响最终的机器代码。
　　
上面那个 验证用户 的方框，我们可以把它当成一块板子，在这块板子上插入一些控制流程，这块板子就可以当成是 AOP 中的一个切面。

所以 AOP 的本质是在一系列的纵向的控制流程中，把那些相同的子流程提取成一个横向的面，把纵向流程画成一条直线，而 AOP 相当于把相同的地方连起来了

再来一幅图理解一下：
![](https://img-blog.csdnimg.cn/20190527202553423.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyNTM5NTMz,size_16,color_FFFFFF,t_70)

这个验证用户的子流程 就成了一条直线，也可以理解成一个切面，这里只插了三个流程，如果其他流程也需要这个子流程，也可以插到其他地方去

参考：
> AOP【面向切面编程】 https://blog.csdn.net/qq_42539533/article/details/90551738

> 面向切面编程 https://www.jianshu.com/p/be6cb39dbeb7